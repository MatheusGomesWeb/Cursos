<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redux - JS Puro</title>
</head>

<body>

  <h1></h1>
  <button data-value="100">Somar</button>
  <script src="./js/redux.min.js"></script>
  <script>
    // constantes globais para evitar erros de código
    const SOMA = "SOMA";
    const SUBTRACAO = "SUBTRACAO";
    const MULTIPLICACAO = "MULTICICACAO"

    // Action Creators (retornar o objeto do dispatch de uma forma mais organizada)
    function multiplicacao(payload) {
      return { type: MULTIPLICACAO, payload };
    }

    // Funçaõ Reducer (estadoAtual (object), action (callback))
    function reducer(salario = 5000, action) {
      if (action.type === SOMA) {
        return salario + action.payload;
      } else if (action.type === SUBTRACAO) {
        return action.payload - 50;
      } else if (action.type === MULTIPLICACAO) {
        return action.payload * 50;
      } else {
        return salario;
      }
    }

    // Estado global da aplicação (store)
    const armazenamento = Redux.createStore(reducer);

    // Estado atual do armazenamento
    // let estadoAtual = armazenamento.getState();

    armazenamento.dispatch({ type: SOMA, payload: 50 });

    function updateVal() {
      document.querySelector('h1').textContent = armazenamento.getState();
    }
    updateVal();

    armazenamento.subscribe(updateVal);

    // Dispatch (executar a action) - ({type: string, value?})
    //armazenamento.dispatch({ type: SOMA, payload: 100 });
    //armazenamento.dispatch({ type: SUBTRACAO, payload: 100 })
    //armazenamento.dispatch(multiplicacao(100));

    // Atualizar o estado com o novo valor
    // estadoAtual = armazenamento.getState();

    // Atualizando o valor do estado ao clicar no botao
    const botao = document.querySelector('button');

    if (botao) {
      botao.addEventListener('click', ({ target }) => {
        armazenamento.dispatch({
          type: SOMA,
          payload: parseInt(target.dataset.value)
        });
      })
    }

  </script>
</body>

</html>